*
  box-sizing border-box

body
  display flex
  align-items center
  justify-content center
  min-height 100vh
  // Use currentColor as a hack for the background color ðŸ˜…
  color purple
  background #111

input
  position absolute
  top 0
  right 0
  bottom 0
  left 0
  width 100vw
  height 100vh
  opacity 0

/**
* If the input is valid, make the broom sweep
* But also hide the curved out bristles by rotating the whiskers back
*/
input:valid ~ .broom-container .broom
  animation sweep 1.15s infinite ease both

  .broom__handle
    animation-name none

  .broom-bristle__wrap
    animation-name none

  .broom-bristle
    border-radius 0 50% 35% 0 / 0 50% 15% 0

    &:after
      transform translate(-100%, 0) rotate(45deg)

    &:before
      transform scale(0) rotate(15deg)


input:valid:not(:focus) ~ .broom-container .broom
  animation-name none


/**
* This is the default state as the placeholder is shown.
* As soon as we start tapping keys, let's up the pace and make the broom
* pointy toed
*/
input:placeholder-shown ~ .broom-container
  .broom
    animation-name none

    .broom__handle
      animation-name shake

    .broom__bristles--left .broom-bristle__wrap
      animation-delay 0.5s

    .broom-bristle__wrap
      animation-name waddle
      animation-duration 1s

      .broom-bristle
        border-radius 0 50% 35% 40% / 0 50% 0% 40%
        transform scaleY(1)

        &:after
          transform translate(0, 0) rotate(15deg)

        &:before
          transform scale(1) rotate(20deg)



.broom
  height 100%
  width 100%
  z-index 2
  transition transform .25s ease
  transform-origin 50% 10%
  animation none

  &__handle
    position absolute
    top 0
    left 50%
    height 65%
    background linear-gradient(90deg, brown, yellow)
    width 8%
    transform translate(-50%, 0)
    transform-origin bottom center
    border-radius 50% 50% 0 0 / 5% 5% 0 0
    animation-name shake
    animation-duration 1s
    animation-iteration-count infinite
    animation-timing-function ease

    @keyframes shake
      0%, 100%
        transform translate(-50%, 0) rotate(-2deg)
      50%
        transform translate(-50%, 0) rotate(2deg)

    /**
    * Use pseudo elements for the top of the brush
    * That way we can use overflow hidden on the brush
    */
    &:before
      content ''
      background red
      position absolute
      width 250%
      height 5%
      bottom 0
      left 50%
      z-index 2
      transform translate(-50%, 0)
    &:after
      content ''
      z-index 2
      background yellow
      position absolute
      width 300%
      height 5%
      left 50%
      bottom 5%
      transform translate(-50%, 0)
      $clip = polygon(0 0, 100% 0, 85% 100%, 15% 100%)
      -webkit-clip-path $clip
      clip-path $clip

  &__brush
    width 100%
    height 35%
    position absolute
    bottom 0
    left 0
    overflow hidden

  &__bristles
    position absolute
    left 49%
    top 0
    height 100%
    width 50%
    overflow hidden

    &--left
      transform-origin left center
      transform rotateY(180deg) translate(-3%, 0)

/**
* There are three brush modes
* 1. Indeterminate which will be walking (Pointy walk)
* 2. Prior to life and sweeping which will look like a normal broom (Standard broom)
* 3. When something is typed but not sweep (Pointy bounce)
*/


/**
* Trick to the bristles is to create one and mirror it
* Brush mode 2 is the default and doesn't rely on any extra moving parts.
* Brush modes 1 & 3 rely on pseudo elements and adjustment of the border-radius
*/
.broom__bristles--left .broom-bristle__wrap
  animation-delay -0.25s

.broom-bristle
  width 40%
  background yellow
  height 100%
  position absolute
  top 0
  left 0
  transition border-radius .1s ease, transform .1s ease
  border-radius 0 80% 20% 100% / 0 50% 0% 150%
  transform scaleX(1.15)
  /**
  * Brush mode 1 means the after pseudo element is visible and the bristles
  * have a 0 bottom radius
  */
  &:after
    content ''
    position absolute
    background transparent
    height 40%
    width 100%
    bottom -2%
    left 45%
    border-radius 100%
    box-shadow 0 -15px 0px 0px yellow inset
    transition transform .15s ease
    transform translate(0, 0) rotate(15deg)
    z-index 2

  &:before
    content ''
    position absolute
    height 20%
    width 50%
    background transparent
    box-shadow 0 -5px 0 0 yellow inset
    bottom 12%
    left 95%
    border-radius 100%
    transition transform .1s ease
    transform scale(1) rotate(15deg)




.broom-bristle__wrap
  position absolute
  top 0
  width 100%
  height 100%
  left 0
  transform-origin top left
  overflow hidden
  animation-duration .5s
  animation-iteration-count infinite
  animation-timing-function ease
  animation-name waddle-high

  @keyframes waddle-high
    0%, 100%
      transform scaleY(1)
    50%
      transform scaleY(0.85) rotate(-5deg)

  @keyframes waddle
    0%, 100%
      transform scaleY(1)
    50%
      transform scaleY(0.95) rotate(-3deg)



.broom-container
  --x 0
  display block
  height 250px
  width 150px
  transition transform .25s ease
  position relative
  transform translate(calc(var(--x, 0) * 1%), calc(var(--y, 0) * 1%))
  z-index 5


.left
  height 100vh
  width 50vw
  position absolute
  left 0
  top 0
  z-index 3
  opacity .15

  // &:hover
  //   z-index 999
  //   & ~ .broom-container
  //     opacity .5
  //     --x -200
  //   opacity .8

@keyframes sweep
  0%, 5%, 95%, 100%
    transform rotate(15deg)
  45%, 50%, 55%
    transform rotate(-15deg)

// TODO: Drop-filter hover positioning LEFT CENTER RIGHT refactor to CSS vars, one animation etc.