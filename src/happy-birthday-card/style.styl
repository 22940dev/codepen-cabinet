@import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap')
*
  box-sizing border-box
  // transform-style preserve-3d

h1
  position fixed
  bottom 2rem
  right 2rem
  margin 0
  font-size 3rem
  font-family "Fredoka One", cursive
  color hsl(210, 32%, 15%)


:root
  --bg hsl(210, 32%, 24%)
  --body hsl(0, 0%, 100%)
  --stripes hsl(10, 80%, 80%)
  --flame-1 hsl(30, 80%, 60%)
  --flame-2 hsl(45, 90%, 80%)
  --paper hsl(210, 80%, 85%)
  --paper-2 hsl(210, 80%, 95%)
  --paper-3 hsl(210, 80%, 60%)
  --card hsl(0, 0%, 98%)
  --insert hsl(210, 80%, 85%)
  --bottom-frosting hsl(10, 80%, 80%)
  --mid-frosting hsl(180, 80%, 80%)
  --top-frosting hsl(90, 80%, 80%)
  --balloon-3 10
  --balloon-2 180
  --balloon-1 90
  --size 35vmin
  --height var(--size)
  --width calc(var(--size) * 1.4)
  --read 0
  --transition 0.2s

body
  background var(--bg)
  min-height 100vh
  perspective 1000px
  transform-style preserve-3d
  overflow hidden

input
  opacity 0
  position fixed
  right 100%

label
  height 100vh
  width 100vw
  position fixed
  top 0
  left 0
  z-index 2
  transform-style preserve-3d
  transform translate3d(0, 0, 100px)

:checked ~ .scene
  --read 1

  .hide-back
    -webkit-backface-visibility hidden
    backface-visibility hidden

  .cake__candle
    transform translate(0, 0)

.stamp
  height 8vmin
  position absolute
  top 50%
  left 50%
  transform translate3d(-50%, -50%, 1px)
  filter saturate(0.5)

.barcode
  height 6vmin
  width 8vmin
  position absolute
  bottom 2vmin
  right 2vmin
  transform translate3d(0, 0, 1px)
  --l hsl(0, 0%, 50%)
  background repeating-linear-gradient(90deg, var(--l) 0 1%, transparent 1% 2%, var(--l) 2% 4%, transparent 4% 5%, var(--l) 5% 10%)

.scene
  display flex
  align-items center
  justify-content center
  transform rotateY(calc(var(--x, 0) * 1deg)) rotateX(calc(var(--y, 0) * 1deg))
  height 100vh
  width 100vw
  transform-style preserve-3d

.card
  height calc(var(--height))
  position relative
  width var(--width)
  transform-style preserve-3d
  transform translate(0, calc(var(--read, 0) * 25%)) rotateX(calc(var(--read, 0) * 90deg))
  transition transform var(--transition)

  &__confetti
    --size calc(var(--s) * 1vmin)
    height var(--size)
    width var(--size)
    position absolute
    top 0%
    left 50%
    transition transform calc(var(--read) * var(--transition)) calc(var(--read) * var(--transition)), opacity calc(var(--read) * var(--transition)) calc((var(--read) * var(--transition)) * 2)
    transform scale(var(--read)) translate(-50%, 10%) rotate(calc(var(--r) * 1deg)) rotateX(calc(var(--a) * 1deg)) skew(calc(var(--sk) * 1deg)) translate(0, calc(var(--height) * (var(--read, 0) * 1.5)))
    opacity calc(1 - var(--read))

    &:after
      background 'hsl(%s, 80%, 80%)' % var(--hue)
      content ''
      position absolute
      height 100%
      width 100%
      transition transform calc(var(--read) * var(--transition)) calc(var(--read) * var(--transition))
      transform rotateX(calc((var(--rx) * var(--read)) * 1deg)) rotateY(calc((var(--ry) * var(--read)) * 1deg))

  &__content
    transform-style preserve-3d
    height 100%
    width 100%
    &--bottom
      // transform-style preserve-3d
      &:before
        content ""
        position absolute
        top 0
        left 0
        height 100%
        width 100%
        background var(--insert)
        $clip = polygon(0 0, 15% 0, 15% 30%, 85% 30%, 85% 0, 100% 0, 100% 100%, 0 100%)
        -webkit-clip-path $clip
        clip-path $clip
    &--top
      // transform-style preserve-3d
      &:before
        content ""
        position absolute
        top 0
        left 0
        height 100%
        width 100%
        background var(--insert)
        $clip = polygon(0 0, 100% 0, 100% 100%, 85% 100%, 85% 70%, 78% 70%, 78% 46%, 72.4% 46%, 72.4% 26.8%, 27.6% 26.8%, 27.6% 46%, 22% 46%, 22% 70%, 15% 70%, 15% 100%, 0 100%)
        -webkit-clip-path $clip
        clip-path $clip

  &__message
    position absolute
    padding 1rem
    font-family sans-serif
    bottom 0
    left 50%
    transform translate(-50%, 0)

  &__part
    height var(--h, 100%)
    width var(--w, 100%)
    position absolute
    top 0%
    left 50%
    transform translate(-50%, 0)
    transform-style preserve-3d

  &__inner
    --h 96%
    --w 95%
    transform translate3d(-50%, 0, calc(var(--height) * 0))

  &__sleeve
    height 100%
    width 100%

.message
  font-size 4.5vmin
  font-family "Fredoka One", cursive
  color hsl(0, 0%, 10%)
  display flex
  flex-direction column
  position absolute
  top 50%
  left 20%
  transform translate3d(0, -50%, 0)
  margin 0

.card__message
  font-family "Fredoka One", cursive
  color hsl(0, 0%, 10%)
  font-size 4vmin
  white-space nowrap
  position absolute
  top 50%
  left 50%
  transform translate(-50%, 0)

.flip
  transform-style preserve-3d

  &__piece
    height 100%
    position absolute
    width 100%
    transform-origin 50% 0
    transform-style preserve-3d
    transition transform var(--transition)

    &--front
      transform rotateX(calc(var(--front) * 1deg))
    &--back
      transform rotateX(calc(var(--rear) * 1deg))

.card__inner
  // Either 1.75 or 89.75
  --rear calc(-1.75 + (var(--read, 0) * 2))
  --front calc(1.75 + (var(--read, 0) * 88))

.card__outer
  --rear calc(-2 + (var(--read, 0) * 2))
  --front calc(2 + (var(--read, 0) * 88))

.card__content-container
  transform-style preserve-3d
  height 100%
  width 100%
  top 0
  left 0
  position absolute
  &--inner-top
    transform rotate(180deg) translate3d(0, 0, 0)
  &--inner-bottom
    transform translate3d(0, 0, 0)

.cover__content
  height 100%
  width 100%
  background var(--card)
  position absolute
  font-size 2vmin
  transform-style preserve-3d

  &--front
  &--rear
    transform translate3d(0, 0, 1px)

.front-cover__front
.rear-cover__front
  background var(--card)

.front-cover__front:after
.rear-cover__front:after
  content ''
  position absolute
  top 0%
  left 50%
  transform translate3d(-50%, 0, 0px)
  background var(--paper-3)
  height 95%
  width 95%
.rear-cover__front:after
  transform translate(-50%, 0, 2px)

.cake__section
  position absolute
  transform-style preserve-3d
  transition var(--transition)

  &--top
    height 80%
    width 80%
    left 50%
    bottom 0

    &-top
      transform translate(-50%, 0) rotateX(calc(var(--read, 0) * 90deg)) translate3d(0, -100%, calc(var(--read, 0) * 0px)) rotateX(calc(var(--read, 0) * -90deg))
      transform-origin 50% 100%
      background var(--paper)
    &-front
      background var(--paper-2)
      transform-origin 50% 100%
      transform translate(-50%, -100%) rotateX(calc(var(--read, 0) * 90deg))

  &--mid
    height 80%
    width 80%
    left 50%

    &-front
      bottom 0
      transform-origin 50% 0
      transform translate3d(-50%, 0, 0) rotateX(calc((180 - (var(--read, 0) * -90)) * 1deg))
      background var(--paper-2)

    &-top
      background transparent
      bottom 0
      transform-origin 50% 100%
      transform translate(-50%, 0) rotateX(calc(var(--read, 0) * 90deg)) translate3d(0, -100%, calc(var(--read, 0) * 0px)) rotateX(calc(var(--read, 0) * -90deg))

      &:before
        content ''
        position absolute
        height 100%
        width 100%
        $clip = polygon(0 0, 10% 0, 10% 80%, 90% 80%, 90% 0, 100% 0, 100% 100%, 0 100%)
        -webkit-clip-path $clip
        clip-path $clip
        transform rotate(180deg)
        background var(--paper)

  &--bottom
    height 30%
    width 70%
    left 50%
    transition var(--transition)

    &-top
      background transparent
      transform-origin 50% 100%
      bottom 0
      transform translate(-50%, -100%) rotateX(calc(var(--read, 0) * -90deg))

      &:before
        content ''
        position absolute
        height 100%
        width 100%
        $clip = polygon(0 0, 10% 0, 10% 80%, 90% 80%, 90% 0, 100% 0, 100% 100%, 0 100%)
        -webkit-clip-path $clip
        clip-path $clip
        transform rotate(180deg)
        background var(--paper)

    &-front
      background var(--paper-2)
      top 0
      transform-origin 50% 0
      transform translate(-50%, 100%) rotateX(calc(var(--read, 0) * 90deg))

.section
  height 100%
  width 100%

  &__piece
    position absolute
    height 100%
    width 100%
    transform-style preserve-3d

    &--back
      transform rotateY(180deg)

.balloon
  overflow visible !important
  height 6vmin
  position absolute
  left calc(var(--x, 0) * 1%)
  top calc(var(--y, 0) * 1%)
  animation float calc(var(--s, 0) * 1s) calc(var(--d, 0) * 1s) infinite

  &__body
    fill 'hsla(%s, 80%, 50%, 0.75)' % var(--hue, 0)

  &__glare
    fill hsla(0, 0%, 100%, 0.75)

  &__shadow
    fill 'hsla(%s, 80%, 30%, 0.75)' % var(--hue, 0)

  &__string
    stroke hsl(40, 40%, 50%)

  &:nth-of-type(1)
    --hue var(--balloon-1)
    --x 58
    --y 28
  &:nth-of-type(2)
    --hue var(--balloon-2)
    --x 68
    --y 20
  &:nth-of-type(3)
    --hue var(--balloon-3)
    --x 65
    --y 40

.cake
  overflow visible !important
  width 100%
  height 100%
  transform translate3d(0, 0, 1px)

  &__frosting
    fill var(--frosting)

  &__eyes
    transform-origin 50% 24px
    animation blink 5s infinite

  &__body
    fill var(--body)

  &--bottom
    --frosting var(--bottom-frosting)
  &--mid
    --frosting var(--mid-frosting)
  &--top
    --frosting var(--top-frosting)

  &--bottom
  &--mid
    transform translate3d(0, 0, -1px) rotate(180deg)

  &--mid
  &--top
    .cake__sprinkles
      transform translate(0, -8px)

  &__candle
    transform translate(0, 12px)
    transition var(--transition)


  &__sprinkle
    fill 'hsl(%s, 80%, 70%)' % var(--hue)

.candle
  &__body
    fill var(--body)
  &__stripes
    fill var(--stripes)
  &__flame
    animation scribble 0.5s infinite
  &__flame-outer
    fill var(--flame-1)
  &__flame-inner
    fill var(--flame-2)

@keyframes blink
  0%, 47%, 49%, 51%, 100%
    transform scaleY(1)
  48%, 50%
    transform scaleY(0.1)


@keyframes float
  0%, 100%
    transform translate3d(0, 0, calc(var(--s) * 1px))
  50%
    transform translate3d(0, -25%, calc(var(--s) * 1px))

@keyframes scribble
  0%
    filter url('#scribble--0')
  25%
    filter url('#scribble--1')
  50%
    filter url('#scribble--2')
  75%
    filter url('#scribble--3')
  100%
    filter url('#scribble--4')